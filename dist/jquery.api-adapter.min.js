!function(e,t){"function"==typeof define&&define.amd?define(["jquery","jquery.request"],t):"object"==typeof exports?module.exports=t(require("jquery"),require("jquery.request")):e.jQuery=t(e.jQuery,e.jQuery.Request)}(this,function(e,t){return function(e){"use strict";function t(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&1===e.nodeType&&"string"==typeof e.nodeName}function n(t){return e.Request(t).then(function(e){return e.response?e.response:e})}function r(n,r){if(r="object"!=typeof r?{}:r,t(r)){var o=e(":focus"),i=e(r);i.wrap("<form></form>");var a=i.parent();r=a.serializeObject(),i.unwrap(),o.focus()}var u=n.indexOf("?")>-1?"&":"?",s=e.param(r);return n+(s.length>0?u+e.param(r):"")}function o(t,n){if(e.isArray(n))for(var o,i=0;(o=t.match(/{[^}]+}/))&&(t=t.replace(/{[^}]+}/,n[i]),i++,n[i]););else for(var a in n)t=t.replace("{"+a+"}",n[a]);var u=s.extraParams;return r(t,u)}function i(e,t){return t.links&&(t.links.next&&(t.next=a(e,t.links.next.href)),t.links.previous&&(t.previous=a(e,t.links.previous.href))),t}function a(e,t){return function(){t.match(/^http[s]?:/i)||(t=s.baseUrl?s.baseUrl()+t:window.location.protocol+"//"+window.location.host+t);var o=r(t,{});return f[e]||(f[e]={}),f[e][o]||(f[e][o]=n({url:t,type:"GET",dataType:c[e].dataType})),f[e][o].promise().then(function(t){return i(e,t)})}}function u(t,a,u,l){l="object"!=typeof l?{no_cache:l}:l;var d=a,y=c[t],h=null;if("string"==typeof d){var m,g={},b=e.Request.parseUri(d),v=y.endpoint.split(/\//),w=b.path.split(/\//);if(v.length==w.length)for(var j=0;j<v.length;j++)if(m=v[j].match(/^{([^}]+)}$/))g[m[1]]=w[j];else if(v[j]!=w[j]){h=d;break}d=g,b.query.length>0&&(u="object"!=typeof u?{}:u,u=e.extend(u,e.deparam(b.query))),h&&(h=r(h,s.extraParams))}h||(h=o(y.endpoint,d)),h.match(/^http[s]?:/i)||(h=s.baseUrl?s.baseUrl()+h:window.location.protocol+"//"+window.location.host+h);var q="GET"==y.type?r(h,u):h;if(e.isArray(d)){for(var x,_={},m=y.endpoint.match(/{[^}]+}/g),j=0;j<m.length;j++)x=m[j].replace(/^{/,"").replace(/}$/,""),d[j]&&(_[x]=d[j]);d=_}return f[t]||(f[t]={}),u=y.before_send(u),f[t][q]&&!l.no_cache||(f[t][q]=n(e.extend({},l,y,{url:h,data:u,dataType:p}))),function(e,n){f[t][n].promise().then(function(t){e.success({response:t,route:e,request_cache:f,no_cache:l.no_cache})},function(r){e.failure(r),delete f[t][n]})}(y,q),"GET"!=y.type&&!function(e){f[t][e].promise().then(function(){f[t][e]=null})}(q),f[t][q].promise().then(function(e){return y.filter_response?y.filter_response(e,d,a,u).then(function(e){return i(t,e)}):i(t,e)})}var s={};s.baseUrl=function(){return s.domain},s.extraParams={},s.domain=window.location.protocol+"//"+window.location.host;var c={},f={},p="json";return s.logger=function(){try{var e=Array.prototype.slice.call(arguments,0);e.shift()}catch(t){}},s.clearCache=function(e){return f[e]={},!0},s.addRoute=function(t,n,r){r="object"!=typeof r?{}:r,r.endpoint=n,r.type="string"!=typeof r.type?"GET":r.type.toUpperCase(),r.dataType="string"!=typeof r.dataType?p:r.dataType,r.success="function"!=typeof r.success?function(){}:r.success,r.failure="function"!=typeof r.failure?function(){}:r.failure,r.before_send="function"!=typeof r.before_send?function(e){return e}:r.before_send,r.filter_response="function"!=typeof r.filter_response?function(t){return e.Deferred().resolve(t)}:r.filter_response,r.cors="boolean"!=typeof r.cors?!0:r.cors,r.processData="boolean"!=typeof r.processData?!0:r.processData,c[t]&&s.logger("warn","Overwriting already defined route",t),c[t]=e.extend({},r)},s.execute=function(e,t,n,r){return c[e]?u(e,t,n,r):(s.logger("error","Could not execute undefined route",e),!1)},s.url=function(t,n,i){if(!c[t])return s.logger("error","Could not execute undefined route",t),!1;var a=c[t],u=null;if("string"==typeof n){var f,p={},l=e.Request.parseUri(n),d=a.endpoint.split(/\//),y=l.path.split(/\//);if(d.length==y.length)for(var h=0;h<d.length;h++)if(f=d[h].match(/^{([^}]+)}$/))p[f[1]]=y[h];else if(d[h]!=y[h]){u=n;break}n=p,l.query.length>0&&(i="object"!=typeof i?{}:i,i=e.extend(i,e.deparam(l.query))),u&&(u=r(u,s.extraParams))}return u||(u=o(a.endpoint,n)),u.match(/^http[s]?:/i)||(u=s.baseUrl?s.baseUrl()+u:window.location.protocol+"//"+window.location.host+u),"GET"!=a.type&&(u=r(u,{_method:a.type})),"undefined"!=typeof i&&(u=r(u,i)),u},e.Api=s,s}(e),e.Api});