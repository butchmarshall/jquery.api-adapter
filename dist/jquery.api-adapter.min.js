!function(e,t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):e.jQuery.Api=t(e.jquery)}(this,function(e){return function(e){"use strict";e(window.jQuery)}(function(e){"use strict";function t(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&1===e.nodeType&&"string"==typeof e.nodeName}function n(t){return e.Request(t).then(function(e){return e.response?e.response:e})}function r(n,r){if(r="object"!=typeof r?{}:r,t(r)){var o=e(":focus"),i=e(r);i.wrap("<form></form>");var a=i.parent();r=a.serializeObject(),i.unwrap(),o.focus()}var u=n.indexOf("?")>-1?"&":"?",s=e.param(r);return n+(s.length>0?u+e.param(r):"")}function o(t,n){if(e.isArray(n))for(var o,i=0;(o=t.match(/{[^}]+}/))&&(t=t.replace(/{[^}]+}/,n[i]),i++,n[i]););else for(var a in n)t=t.replace("{"+a+"}",n[a]);var u=s.extraParams;return r(t,u)}function i(e,t){return t.links&&(t.links.next&&(t.next=a(e,t.links.next.href)),t.links.previous&&(t.previous=a(e,t.links.previous.href))),t}function a(e,t){return function(){t.match(/^http[s]?:/i)||(t=s.baseUrl?s.baseUrl()+t:window.location.protocol+"//"+window.location.host+t);var o=r(t,{});return c[e]||(c[e]={}),c[e][o]||(c[e][o]=n({url:t,type:"GET",dataType:f[e].dataType})),c[e][o].promise().then(function(t){return i(e,t)})}}function u(t,a,u,l){var d=a,y=f[t],h=null;if("string"==typeof d){var m,g={},v=e.Request.parseUri(d),b=y.endpoint.split(/\//),w=v.path.split(/\//);if(b.length==w.length)for(var x=0;x<b.length;x++)if(m=b[x].match(/^{([^}]+)}$/))g[m[1]]=w[x];else if(b[x]!=w[x]){h=d;break}d=g,v.query.length>0&&(u="object"!=typeof u?{}:u,u=e.extend(u,e.deparam(v.query))),h&&(h=r(h,s.extraParams))}h||(h=o(y.endpoint,d)),h.match(/^http[s]?:/i)||(h=s.baseUrl?s.baseUrl()+h:window.location.protocol+"//"+window.location.host+h);var j="GET"==y.type?r(h,u):h;if(e.isArray(d)){for(var T,q={},m=y.endpoint.match(/{[^}]+}/g),x=0;x<m.length;x++)T=m[x].replace(/^{/,"").replace(/}$/,""),d[x]&&(q[T]=d[x]);d=q}return c[t]||(c[t]={}),u=y.before_send(u),(!c[t][j]||l)&&(c[t][j]=n({url:h,type:y.type,cors:y.cors,data:u,dataType:p})),function(e,n){c[t][n].promise().then(function(t){e.success({response:t,route:e,request_cache:c,no_cache:l})},function(r){e.failure(r),delete c[t][n]})}(y,j),"GET"!=y.type&&!function(e){c[t][e].promise().then(function(){c[t][e]=null})}(j),c[t][j].promise().then(function(e){return y.filter_response?y.filter_response(e,d,a,u).then(function(e){return i(t,e)}):i(t,e)})}var s={};s.baseUrl=function(){return s.domain},s.extraParams={},s.domain=window.location.protocol+"//"+window.location.host;var f={},c={},p="json";s.logger=function(){try{{var e=Array.prototype.slice.call(arguments,0);e.shift()}}catch(t){}},s.clearCache=function(e){return c[e]={},!0},s.addRoute=function(t,n,r){r="object"!=typeof r?{}:r,r.endpoint=n,r.type="string"!=typeof r.type?"GET":r.type.toUpperCase(),r.dataType="string"!=typeof r.dataType?p:r.dataType,r.success="function"!=typeof r.success?function(){}:r.success,r.failure="function"!=typeof r.failure?function(){}:r.failure,r.before_send="function"!=typeof r.before_send?function(e){return e}:r.before_send,r.filter_response="function"!=typeof r.filter_response?function(t){return e.Deferred().resolve(t)}:r.filter_response,r.cors="boolean"!=typeof r.cors?!0:r.cors,f[t]&&s.logger("warn","Overwriting already defined route",t),f[t]=e.extend({},r)},s.execute=function(e,t,n,r){return f[e]?u(e,t,n,r):(s.logger("error","Could not execute undefined route",e),!1)},s.url=function(t,n,i){if(!f[t])return s.logger("error","Could not execute undefined route",t),!1;var a=f[t],u=null;if("string"==typeof n){var c,p={},l=e.Request.parseUri(n),d=a.endpoint.split(/\//),y=l.path.split(/\//);if(d.length==y.length)for(var h=0;h<d.length;h++)if(c=d[h].match(/^{([^}]+)}$/))p[c[1]]=y[h];else if(d[h]!=y[h]){u=n;break}n=p,l.query.length>0&&(i="object"!=typeof i?{}:i,i=e.extend(i,e.deparam(l.query))),u&&(u=r(u,s.extraParams))}return u||(u=o(a.endpoint,n)),u.match(/^http[s]?:/i)||(u=s.baseUrl?s.baseUrl()+u:window.location.protocol+"//"+window.location.host+u),"GET"!=a.type&&(u=r(u,{_method:a.type})),"undefined"!=typeof i&&(u=r(u,i)),u},e.Api=s}),jQuery.Api});